{
  "hash": "251a59c0ebc1a98dc66dda5be640594d",
  "result": {
    "markdown": "---\ntitle: Rufous V Rufous \ndraft: true\nengine: knitr\ndate: 2023-05-11\nauthor: Cait Harrigan\nimage: thumbnail.jpng\ntoc: true\ncategories:\n  - birds\n  - code\n  - data analysis\n  - deep-dive\nformat:\n  html:\n      code-fold: true\neditor_options: \n  chunk_output_type: console\n---\n\n\nReading time: 9 minutes\n\n::: callout-note\nThis is the second post in this deep-dive series. See here for [part i](https://galiwatch.ca/posts/hummer-behaviour-170323/)\n:::\n\n## Setup\n\nAs previously covered in part i, we're looking at the hummingbird detection data from 2021. We did some preliminary data exploration, and saw some interesting patterns in the visit times of different birds.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(patchwork)\nlibrary(ggpubr)\n\nweather <- readr::read_csv('https://raw.githubusercontent.com/teaswamp-creations/galiwatch.ca/quarto-website/posts/hummer-behaviour-170323/WS_hours.csv') %>%\n  # retain only non-duplicates\n  distinct() %>%\n  # Clean up timestamps, convert to celsius\n  mutate(Date = ymd(Date), \n         MergeTime = ymd_hms(paste(Date, Time)),\n         `Temp C` = (`Outdoor Temperature F`-32) * (5/9)\n         )\n\n# classifier labels\nclasses = c('Rufous_Male', 'Annas_Male', 'Person', 'Annas_Female', 'Rufous_Female')\n\n# read in bird detection data, and do some basic data cleaning\nbird <- read_csv('https://raw.githubusercontent.com/teaswamp-creations/galiwatch.ca/quarto-website/posts/hummer-behaviour-170323/2021_reprocessed_hummers_combo_2023.csv') %>% \n  # lookup labels\n  mutate(class = classes[label + 1]) %>%\n  # put columns into tidy format\n  separate(class, into=c('Species', 'Sex'), sep='_') %>%\n  separate(image, into=c('Date', 'image'), sep=\"_\", remove = F) %>%\n  separate(image, into=c('hhmm'), sep=\".jpg\", extra = 'drop') %>%\n  # clean up timestamps\n  mutate(Timestamp = ymd_hm(paste(Date, hhmm))) %>%\n  # remove people\n  filter(label != 2) %>%\n  # change column types, correct for variable image size\n  mutate(Date=ymd(Date),\n         Month=factor(month(Date, label = T)),\n         Hour=hour(Timestamp),\n         Species = ordered(Species),\n         Sex = factor(Sex),\n         ymin2 = ymin,\n         ymin = (y_size - ymax),\n         ymax = (y_size - ymin2),\n         MergeTime = floor_date(Timestamp, 'hour')\n  ) %>%\n  # correct for variable image size\n  mutate(\n    ymin = ifelse(y_size == 420, ymin * (616/420), ymin),\n    ymax = ifelse(y_size == 420, ymax * (616/420), ymax),\n    xmin = ifelse(y_size == 420, xmin * (616/420), xmin),\n    xmax = ifelse(y_size == 420, xmax * (616/420), xmax), \n    xmid = (xmax+xmin)/2,\n    ymid = (ymax+ymin)/2\n  ) \n```\n:::\n\n\n## Distribution of sitting spots\n\nWe can plot the location of where each bird sits, with the proxy that a birds' feet will be at the center bottom of its bounding box. The birds appear to mostly sit in a circle, around the rim of the feeder. This makes sense, as it gives the best access to the sugar water.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird %>% \n  ggscatter(x='xmid', y = 'ymid', alpha=0.4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nHowever, it looks like there are 2 distinct positions that the feeder was in over the summer. We'll try to do batch correction for this, by assigning a batch number to each position, and subtract the average from the x and y direction. I think we can reasonably split the changes in position (the batches) simply by the date. This is easy to see in the ymid variable - the feeder moves twice around May 8th, and back down half way through the day on June 13th.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird %>% \n  mutate(ymid = (ymax+ymin)/2, Month = month(Date, label=T)) %>%\n  filter(Date>'2021-05-01' & Date<'2021-06-15') %>%\n  ggplot(aes(x=Timestamp, y = ymid))+ \n  geom_jitter(alpha = 0.5) + \n  facet_wrap(\"~Month\", scales = 'free_x') + \n  theme_pubr() + \n  labs(title = 'Feeder Moves Up and Down in May')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nLets split these into batches for correction.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird$batch <- 1\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-08 00:00:00'),2,bird$batch)\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-11 00:00:00'),3,bird$batch)\nbird$batch <- factor(bird$batch)\n```\n:::\n\n\nWe can check it went as expected by recolouring the previous plot by batch\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird %>% \n  mutate(Month = month(Date, label=T)) %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>% \n  filter(Date>'2021-05-01' & Date<'2021-06-15') %>%\n  ggplot(aes(x=Timestamp, y = ymid, color=batch))+ \n  geom_point(alpha = 0.5) + \n  facet_wrap(\"~Month\", scales = 'free_x') + \n  theme_pubr() + \n  labs(title = 'We can Infer Position Batches Based on When the Feeder Moves',\n       colour = 'Batch')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nNow we're ready to correct! We'll transform all the x- and y- values by subtracting the average of each batch. This will yield a new positioning relative to the middle of the feeder; we can no longer interpret this as the pixel index in the image.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_c <- bird %>% \n  mutate(Month = month(Date, label=T)) %>%\n  group_by(batch) %>%\n  mutate(across(c(xmin, xmax, ymin, ymax), ~ .x-mean(.x)) ) %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2)\n\n\nbird_c %>% \n  filter(Date>'2021-05-01' & Date<'2021-06-15') %>%\n  ggplot(aes(x=Timestamp, y = ymid, color=batch))+ \n  geom_point(alpha = 0.5) + \n  facet_wrap(\"~Month\", scales = 'free_x') + \n  theme_pubr() + \n  labs(title = 'Batch corrected for average position',\n       colour = 'Batch')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nWe can see that the correction didn't completely fix things - our points are still offset by batch!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_c %>%\n  ggscatter(x='xmid', y = 'ymid', alpha=0.1, color = 'batch') + \n  labs(title = 'Batches don\\'t perfectly overlap', fill = 'Batch') \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nIt's a little hard to see in the scatter plot, but when we plot the density of points, it becomes apparent that we should be correcting for the perspective 'stretch' that happens when the feeder is in a different postion in the image.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_c %>%\n  ggplot(aes(x=xmid, y=ymid) ) +\n  stat_density_2d(aes(fill=batch), geom = \"polygon\", alpha=0.2) + \n  theme_pubr() + \n  labs(title = 'Density doesn\\'t match after position correction',\n       subtitle = 'We still need to correct for perspective scaling', fill = 'Batch')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nThe position correction didn't work perfectly, because there is some perspective distortion in the images.\n\nTo fix this, I've centered and scaled the bounding boxes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_m <- bird %>% \n  group_by(batch) %>% \n  summarize(xmin = scale(xmin), ymin = scale(ymin), \n            xmax = scale(xmax), ymax = scale(ymax),\n            .groups = 'keep') %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  bind_cols(select(bird, Timestamp, Species, Sex, confidence))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Returning more (or less) than 1 row per `summarise()` group was deprecated in\ndplyr 1.1.0.\ni Please use `reframe()` instead.\ni When switching from `summarise()` to `reframe()`, remember that `reframe()`\n  always returns an ungrouped data frame and adjust accordingly.\n```\n:::\n\n```{.r .cell-code}\np1 <- bird %>% \n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  ggplot(aes(x=Timestamp, y = xmid, color=batch))+ \n  geom_jitter(alpha = 0.5, show.legend = F) + \n  theme_pubr() + \n  labs(title = 'No Scaling Correction')\n\np2 <- bird_m %>% \n  ggplot(aes(x=Timestamp, y = xmid, color=batch))+ \n  geom_jitter(alpha = 0.5, show.legend = F) + \n  theme_pubr() + \n  labs(title = 'With Scaling Correction')\n\n# y direction\np3 <- bird %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  ggplot(aes(x=Timestamp, y = ymid, color=batch))+ \n  geom_jitter(alpha = 0.5, show.legend = F) + \n  theme_pubr() \n\n\np4 <- bird_m %>%\n  ggplot(aes(x=Timestamp, y = ymid, color=batch))+ \n  geom_jitter(alpha = 0.5, show.legend = F) + \n  theme_pubr()\n\n\n(p1 | p2) / (p3 | p4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nThe batch lineup looks a lot better overall!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_m %>%ggplot(aes(x=xmid, y=ymid, fill=batch)) + \n  stat_density_2d(geom = \"polygon\", alpha=0.2) + \n  labs(title = 'Batch corrected bird location') + \n  theme_pubr()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nThe gap in the middle comes from the water column - we can't detect birds sitting behind it! Of course, we have to be somewhat careful when converting back to the coordinates of the image. (I did this by eyeballing)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg <- jpeg::readJPEG('feeder.jpg')\n\nbird_m %>%\n  ggplot(aes(x=xmid, y = ymid)) + \n  ylim(-1.7,10) + \n  background_image(img) + \n  geom_point() \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 21 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n## Bird size!\n\nNow that we have our corrected bounding boxes, we can have a look at bird sizes!\n\nGoing back to the same height/width plot we saw before, the \"holes\" are nearly gone, .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_m <- bird_m %>%\n  mutate(\n    Height = ymax-ymin, \n    Width = xmax-xmin, \n    Area = abs(Height * Width)\n  )\n\nbird_m %>%\n  mutate(confidence_lvl = cut(confidence, c(0.6, 0.7, 0.8, 0.9, 1), ordered_result=T)) %>%\n  ggscatter(x = \"Width\", y = \"Height\", add = \"reg.line\", alpha = 0.4, color= 'confidence_lvl',\n            add.params = list(color = \"black\", fill = \"lightgray\", linetype='dashed')) +\n  stat_cor(label.x = .25, label.y = 5.75) +\n  stat_regline_equation(label.x = .25, label.y = 5) + \n  labs(title = 'Mid-sized birds are hard-to call?',\n       colour = 'Confidence Level') \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 3237 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nOur low-confidence bird calls seem to be concentrated to a mid-sized bounding box.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird_m %>% \n  mutate(area_lvl = cut(Area, c(0, 0.05, 0.1, 0.2, 0.5, 1), ordered_result=T, include.lowest = T)) %>%\n  #pull(area_lvl) %>% table()\n  mutate(confidence_lvl = cut(confidence, c(0.6, 0.7, 0.8, 0.9, 1), ordered_result=T)) %>%\n  ggplot(aes(x=xmid, y = ymid, color=area_lvl)) + \n  geom_point(alpha = 0.2) + \n  theme_pubr()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 602 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbird_m %>% \n  mutate(area_lvl = cut(Area, c(0, 0.05, 0.1, 0.2, 0.5, 1), ordered_result=T, include.lowest = T)) %>%\n  #mutate(confidence_lvl = cut(confidence, c(0.6, 0.7, 0.8, 0.9, 1), ordered_result=T)) %>%\n  ggplot(aes(x=xmid, y=ymid, fill=area_lvl)) + \n  stat_density_2d(geom = \"polygon\", alpha=0.2) + \n  labs(title = 'Batch corrected bird location') + \n  theme_pubr()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbird <- bird %>% \n  mutate(\n         xmid = (xmax+xmin)/2, \n         ymid = (ymax+ymin)/2,\n         Width = xmax - xmin, \n         Height = ymax - ymin\n  )\n\n\nbird %>%mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  ggscatter(x='xmid', y='Area', color ='ymid') + \n  facet_wrap(~Species)\n```\n:::\n\n\nAlthough Annas are generally larger than Rufous humming birds, we have to keep in mind the camera position. Birds in the middle of the feeder will likely result in bounding boxes that are taller, while birds on the sides may have a wider \"profile view\" bounding box:\n\n![](feeder_view.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# \n# how to make circle plot: pick center of box, plot x/y\n# most interested in feet: on the left - feet are on the left. \n# if you're on the right, your feet are on the right. Could probably pick the center\n\n# change female -> female + immature male\n\nbird_m %>% \n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  mutate(Width = xmax - xmin, Height = ymax - ymin) %>%\n  ggplot() + \n  aes(x=xmid, y = Width, xmax, colour = Sex) +\n  geom_point(alpha = 0.5) + \n  facet_wrap(~Species) +\n  labs(title = 'Birds are wider on the sides of the feeder', subtitle = '(profile view?)')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbird_m %>% \n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  mutate(Width = xmax - xmin, Height = ymax - ymin) %>%\n  ggplot(alpha = 0.5) + \n  aes(x=xmid, y = Height, xmax, colour = Sex) +\n  geom_point() + \n  facet_wrap(~Species) +\n  labs(title = 'Annas are taller (and don\\'t get ID\\'d sitting middle)')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-2.png){width=672}\n:::\n\n```{.r .cell-code}\nbird_m %>% \n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2) %>%\n  mutate(Width = xmax - xmin, Height = ymax - ymin) %>%\n  ggplot(alpha = 0.5) + \n  aes(x=xmid, y = ymid, xmax, colour = Sex) +\n  geom_point() + \n  facet_wrap(~Species) +\n  labs(title = 'Birds mostly sit on the feeder', subtitle = \"Annas are sometimes ID\\'d in flight\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-3.png){width=672}\n:::\n:::\n\n\n# Continuation of hummer-watch data analysis!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbird$batch <- 1\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-08 00:00:00'),2,bird$batch)\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-11 00:00:00'),3,bird$batch)\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-06-13 12:21:00'),4,bird$batch)                  \nbird$batch <- factor(bird$batch)\n\nbird_c <- bird %>% \n  mutate(Month = month(Date, label=T)) %>%\n  group_by(batch) %>%\n  mutate(across(c(xmin, xmax, ymin, ymax), ~ .x-mean(.x)) ) %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2)\n```\n:::\n\n\n# Number of birds in an image for each class\n\nRufous males can be very territorial. We'd like to know whether we can see evidence of the \"chasing away\" behaviour.\n\nIf this is the case, then the disappearance of the male rufous should lead to an increase in the *absolute number* of Annas who come (but might not affect the number of female rufous. And the later disappearance of the female rufous should also lead to an increase in the number of Annas.\n\nBecause it's hard to see this on a minute-to-minute basis, we'll summarize the number of Anna visits by day.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# number of birds per day \n\nbird_c %>% \n  group_by(Date, Species, Sex) %>%\n  summarise(n=n(), `Temp C` = max(`Temp C`), .groups='keep') %>%\n  ggplot() + \n  aes(x = Date, y = n, fill = Sex) + \n  geom_bar(stat = 'identity') +\n  facet_wrap(~Species) + \n  labs(y = 'Number of bird visits', title = 'Most Rufous visit in Summer, Female Annas visit in Fall,\\nMale Annas are year-round')\n\n# Not really what happened\n\nbird_c %>% \n  group_by(Date, Species, Sex) %>%\n  summarise(n=n(), `Temp C` = max(`Temp C`), .groups='keep') %>%\n  ggplot() + \n  aes(x = n, y = `Temp C`, colour = Sex) + \n  geom_point() + \n  geom_smooth(method = 'lm', formula = 'y~x', se = F, linetype='dashed') +\n  facet_wrap(~Species, scales = 'free_x') + \n  labs(x = 'Number of bird visits', title = 'Everyone except Female Annas prefers lower temperatures')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# total number of birds per day\nbird %>%\n  filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  group_by(Date,`Rufous Males present`, Sex, .groups='keep') %>%\n  summarize(n=n()) %>%\n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_rect(aes(fill = Sex),xmin = -Inf,xmax = Inf, ymin = -Inf,ymax = Inf, show.legend = F) + \n  geom_boxplot() + \n  facet_wrap(\"~Sex\") + \n  stat_compare_means(method = \"t.test\", label.y = 180, label.x = 1.3) + \n  geom_bracket(xmin = 1, xmax = 2, label = '', y.position = c(170)) +\n  theme_pubr() + \n  labs(title='Rufous Males are better at scaring off Female Annas than Male Annas') + \n  scale_fill_manual(values = c('chartreuse1', 'chartreuse4'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present', 'Sex'. You\ncan override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# average number of birds per image per day\nbird %>%\n  filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  \n  group_by(Date,`Rufous Males present`, Timestamp, Sex, .groups='keep') %>%\n  summarize(n=n()) %>%\n  group_by(Date, `Rufous Males present`, Sex) %>%\n  summarize(n=mean(n), .groups = 'keep') %>%\n  \n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_rect(aes(fill = Sex),xmin = -Inf,xmax = Inf, ymin = -Inf,ymax = Inf, show.legend = F) + \n  geom_boxplot() + \n  facet_wrap(\"~Sex\") + \n  stat_compare_means(method = \"t.test\", label.y = 1.41, label.x = 1.3) + \n  geom_bracket(xmin = 1, xmax = 2, label = '', y.position = 1.4) +\n  theme_pubr() + \n  labs(title='Rufous Males are better at scaring off Female Annas than Male Annas') + \n  scale_fill_manual(values = c('chartreuse1', 'chartreuse4'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present',\n'Timestamp', 'Sex'. You can override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-2.png){width=672}\n:::\n\n```{.r .cell-code}\nbird %>%\n  group_by(Date, Timestamp, Species, .groups='keep') %>%\n  summarize(n=n()) %>%\n  #group_by(Date, Species) %>%\n  #summarize(n=mean(n), .groups = 'keep') %>%\n  ggplot(aes(x=factor(Date), y = n, colour=Species)) + \n  geom_point()+\n  geom_smooth(aes(colour =Species), method='lm', formula='y~poly(x,4)')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Timestamp', 'Species'. You can\noverride using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-3.png){width=672}\n:::\n\n```{.r .cell-code}\nbird %>%\n  #filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  group_by(Date, `Rufous Males present`, Species, Sex) %>%\n  summarize(n=n()) %>%\n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_boxplot() +\n  facet_grid(rows =vars(Species), cols = vars(Sex), scales='free')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present', 'Species'.\nYou can override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-4.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbird  %>%group_by(Timestamp, Species, Sex) %>% summarize(n=n()) %>% ggplot() +aes(x = Timestamp, y=n, color = Species, fill=Species) + geom_bar(stat='identity') + facet_wrap('~Sex') +scale_color_manual(values=c('chartreuse2', 'chocolate3'))+scale_fill_manual(values=c('chartreuse2', 'chocolate3'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Timestamp', 'Species'. You can override\nusing the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbird %>%\n  group_by(Date, Month = factor(month(Timestamp, label=T)), Hour= hour(Timestamp), Species, Sex) %>%\n  summarise(n=n(), .groups='keep') %>%\n  group_by(Month, Hour, Species, Sex,.groups='keep') %>%\n  summarize(mean_n = mean(n)) %>%\n  ggplot(aes(x=Hour, y = mean_n, colour = Month)) + \n  geom_point() + geom_line() + \n  facet_grid(rows = vars(Species), cols = vars(Sex), scales = 'free')+ \n  labs(y='average number of IDs per day')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Month', 'Hour', 'Species', 'Sex'. You can\noverride using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbird %>%\n  mutate(Hour = hour(Timestamp), Month = factor(month(Timestamp, label=T))) %>%\n  group_by(Month, Hour, Species, Sex) %>%\n  summarise(n=n()) %>%\n  ggplot(aes(x = Hour, y = Month, fill=Month, color =Month)) +\n  ggridges::geom_density_ridges(alpha= 0.2) + \n  facet_grid(rows = vars(Species), cols = vars(Sex))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Month', 'Hour', 'Species'. You can\noverride using the `.groups` argument.\nPicking joint bandwidth of 2.32\nPicking joint bandwidth of 2.35\nPicking joint bandwidth of 2.12\nPicking joint bandwidth of 2.55\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbird %>%\n  mutate(Hour = hour(Timestamp), Month = factor(month(Timestamp, label=T))) %>%\n  ggplot() +\n  aes(x=Hour, fill=Month) +\n  geom_bar() + \n  theme_pubr() + theme(legend.position = 'right') +\n  facet_wrap('~Species', scale='free') +\n  labs(x = 'Hour of Day', y = 'Count', title = 'Daylight changes over the months!')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-40-2.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}