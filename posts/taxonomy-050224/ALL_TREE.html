    <p>Click the red triangles to expand or contract the various taxonomies.  These include the Integrated Taxonomic Information System (ITIS) of worldwide Bees; the US National Centre for Biotechnology Information (NCBI) which contains worldwide organisms with DNA sequence information; the popular "Bug Guide" (https://bugguide.net); and the list of BC Bees from the 2019 manuscript from Sheffield and Heron.  For each, the number of observations from BC in iNaturalist is shown as of January, 2024. Comparing these taxonomies reveals remarkable differences in structure, and demonstrates the rapid flux in naming. If you are using iNaturalist, ITIS is the naming system to follow.  <p> Note that for the ITIS, the Mellitidae are not shown, because....I forgot, and there is only one BC bee. <p>
   
    <ul id="tree">
        <!-- The tree structure will be dynamically generated here -->
    </ul>

    <script>
        async function loadCSV(filePath) {
            const response = await fetch(filePath);
            const data = await response.text();
            const lines = data.split('\n');
            const headers = lines[0].split(',').map(field => field.trim().replace(/^"|"$/g, ''));
            return {
                headers,
                rows: lines.slice(1).map(row =>
                    row.split(',').map(field => field.trim().replace(/^"|"$/g, ''))
                )
            };
        }

        function countSpecies(obj) {
            return Object.values(obj).reduce((count, value) => {
                if (value.__header === 'Species') {
                    return count + 1;
                } else if (typeof value === 'object') {
                    return count + countSpecies(value);
                } else {
                    return count;
                }
            }, 0);
        }

        function generateTree(data, parentElement = document.getElementById('tree')) {
            const headers = data.headers;
            let hierarchy = {};

            data.rows.forEach(row => {
                let currentHierarchyLevel = hierarchy;
                let iNatObsSum = parseInt(row[1], 10) || 0;
                for (let i = 2; i < row.length; i++) {
                    const value = row[i];
                    if (!currentHierarchyLevel[value]) {
                        currentHierarchyLevel[value] = {
                            __header: headers[i],
                            __iNatObsSum: 0,
                            __subspeciesCount: 0,
                            __isSpecies: headers[i] === "Species"
                        };
                    }
                    currentHierarchyLevel[value].__iNatObsSum += iNatObsSum;
                    if (currentHierarchyLevel[value].__isSpecies && row[0].trim() !== "") {
                        currentHierarchyLevel[value].__subspeciesCount += 1;
                    }
                    currentHierarchyLevel = currentHierarchyLevel[value];
                }
            });

            function appendChildren(parent, obj, level = 0) {
                Object.keys(obj).forEach((key, index, array) => {
                    if (key.startsWith('__')) return;
                    const li = document.createElement('li');
                    const span = document.createElement('span');
                    let additionalInfo;

                    if (obj[key].__isSpecies) {
                        additionalInfo = `${obj[key].__subspeciesCount} Subspecies, ${obj[key].__iNatObsSum} Observations`;
                    } else {
                        const speciesCount = countSpecies(obj[key]);
                        additionalInfo = `${speciesCount} Species, ${obj[key].__iNatObsSum} iNat Observations of BC Bees`;
                    }
                    
                    span.textContent = `${obj[key].__header}: ${key} - ${additionalInfo}`;
                    span.classList.add(obj[key].__header.replace(/\s+/g, ''));

                    const ul = document.createElement('ul');
                    ul.className = 'nested' + (level === 0 ? '' : ' hide');

                    if (Object.keys(obj[key]).length > 3) {
                        const arrow = document.createElement('div');
                        arrow.className = 'arrow' + (level === 0 ? ' expanded' : '');
                        arrow.onclick = function() {
                            this.parentElement.querySelector('.nested').classList.toggle('hide');
                            this.parentElement.classList.toggle('expanded');
                        };
                        li.appendChild(arrow);
                    }
                    li.appendChild(span);
                    li.appendChild(ul);
                    parent.appendChild(li);

                    appendChildren(ul, obj[key], level + 1);

                    if (level === 0 && obj[key].__header === "Source") {
                        const separator = document.createElement('div');
                        separator.style.height = '10px';
                        parent.appendChild(separator);
                    }
                });
            }

            appendChildren(parentElement, hierarchy);
        }

        // Load the CSV data and generate the tree
        loadCSV('images/data3.csv').then(data => {
            generateTree(data);
        });
    </script>

